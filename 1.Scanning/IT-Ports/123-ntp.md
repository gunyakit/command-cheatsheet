# Port 123/UDP - NTP

## Table of Contents

- [Enumeration](#enumeration)
- [Exploitation](#exploitation)

---

## Enumeration

### Nmap

```shell
nmap -sU -sV -p 123 $rhost
nmap -sU -p 123 --script ntp-info $rhost
nmap -sU -p 123 --script ntp-monlist $rhost
```

### ntpq

```shell
# Query NTP server
ntpq -p $rhost

# Read variables
ntpq -c readvar $rhost

# Get peer list
ntpq -c peers $rhost

# Get associations
ntpq -c associations $rhost
```

### ntpdc

```shell
# Get server info
ntpdc -n -c monlist $rhost

# Get peer list
ntpdc -n -c listpeers $rhost

# Get system info
ntpdc -n -c sysinfo $rhost
```

---

## Exploitation

### NTP Mode 6 Information Disclosure

```shell
# Get system variables
ntpq -c rv $rhost

# Get peer variables
ntpq -c "rv 0" $rhost
```

### NTP Monlist Attack (CVE-2013-5211)

> Can be used for DDoS amplification (for reference only)

```shell
# Check if monlist is enabled
ntpdc -n -c monlist $rhost

# Nmap check
nmap -sU -p 123 --script ntp-monlist $rhost
```

### Time-based Attacks

```shell
# If NTP is used for authentication timing
# Time skew can be exploited for:
# - Kerberos attacks (time sync required)
# - Certificate validation bypass
# - Log timestamp manipulation

# Check time offset
ntpq -c "rv 0 offset" $rhost
```

### Internal Network Discovery

```shell
# NTP monlist may reveal internal IPs
ntpdc -c monlist $rhost

# Look for internal hosts in peer list
ntpq -c peers $rhost
```

---

## Metasploit

```shell
# NTP Mode 6 info
use auxiliary/scanner/ntp/ntp_peer_list_sum
set RHOSTS $rhost
run

# NTP Monlist
use auxiliary/scanner/ntp/ntp_monlist
set RHOSTS $rhost
run
```

---

## Quick Reference

| Command | Description |
| :--- | :--- |
| `ntpq -p $rhost` | Query NTP peers |
| `ntpq -c readvar $rhost` | Read server variables |
| `ntpdc -c monlist $rhost` | Get monitored clients |
| `nmap -sU -p 123 --script ntp-info $rhost` | NTP enumeration |
