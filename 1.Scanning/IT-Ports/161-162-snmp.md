# Port 161, 162 - SNMP

## Table of Contents
- [Enumeration](#enumeration)
  - [snmpwalk](#snmpwalk)
  - [snmp-check](#snmp-check)
  - [Nmap Scripts](#nmap-scripts)
  - [Common OIDs](#common-oids)
- [Community String Discovery](#community-string-discovery)
- [Windows Enumeration](#windows-enumeration)
- [Attack Vectors](#attack-vectors)

---

## Enumeration

### Quick Check (One-liner)

```shell
snmp-check -t $rhost -c public && snmpwalk -c public -v2c $rhost system 2>/dev/null
```

### Quick SNMP Enumeration (One-liner)

```shell
# Full enumeration with snmp-check
snmp-check -t $rhost -c public 2>/dev/null | tee snmp_enum.txt

# snmpwalk all data
snmpwalk -c public -v2c $rhost 2>/dev/null | tee snmp_walk.txt
```

### Nmap Scripts (One-liner)

```shell
# All SNMP scripts in one command
nmap -sU -p 161 --script "snmp-*" $rhost
```

### Windows Specific OIDs (One-liner)

```shell
# Enumerate Windows users
snmpwalk -c public -v2c $rhost .1.3.6.1.4.1.77.1.2.25 | awk -F'"' '{print $2}' | sort -u

# Enumerate running processes
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.25.4.2.1.2 | awk -F'"' '{print $2}'

# Enumerate installed software
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.25.6.3.1.2 | awk -F'"' '{print $2}'

# Enumerate open TCP ports
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.6.13.1.3 | awk '{print $NF}'
```

### Common OIDs

| OID | Description |
|-----|-------------|
| .1.3.6.1.2.1.1.1.0 | System Description |
| .1.3.6.1.2.1.1.5.0 | System Name |
| .1.3.6.1.4.1.77.1.2.25 | Windows Users |
| .1.3.6.1.2.1.25.4.2.1.2 | Running Processes |
| .1.3.6.1.2.1.25.6.3.1.2 | Installed Software |
| .1.3.6.1.2.1.6.13.1.3 | TCP Ports |
| .1.3.6.1.2.1.4.22.1.3 | ARP Table |

### Extended SNMP OID Reference

| Category | OID | Description |
|----------|-----|-------------|
| **System Info** | .1.3.6.1.2.1.1.1.0 | System Description |
| | .1.3.6.1.2.1.1.3.0 | System Uptime |
| | .1.3.6.1.2.1.1.4.0 | Contact |
| | .1.3.6.1.2.1.1.5.0 | Hostname |
| | .1.3.6.1.2.1.1.6.0 | Location |
| **Windows Users** | .1.3.6.1.4.1.77.1.2.25 | User Accounts |
| | .1.3.6.1.4.1.77.1.4.1 | Domain Name |
| **Processes** | .1.3.6.1.2.1.25.4.2.1.2 | Running Processes |
| | .1.3.6.1.2.1.25.4.2.1.4 | Process Path |
| | .1.3.6.1.2.1.25.4.2.1.5 | Process Parameters |
| **Software** | .1.3.6.1.2.1.25.6.3.1.2 | Installed Software |
| **Network** | .1.3.6.1.2.1.2.2.1.2 | Network Interfaces |
| | .1.3.6.1.2.1.4.20.1.1 | IP Addresses |
| | .1.3.6.1.2.1.4.22.1.3 | ARP Table (IP) |
| | .1.3.6.1.2.1.4.22.1.2 | ARP Table (MAC) |
| **TCP/UDP** | .1.3.6.1.2.1.6.13.1.3 | TCP Local Ports |
| | .1.3.6.1.2.1.7.5.1.2 | UDP Local Ports |
| **Storage** | .1.3.6.1.2.1.25.2.3.1.3 | Storage Description |
| | .1.3.6.1.2.1.25.2.3.1.4 | Storage Allocation Units |
| **Services** | .1.3.6.1.4.1.77.1.2.3.1.1 | Windows Services |
| **Routing** | .1.3.6.1.2.1.4.21.1.1 | Routing Table Destination |
| | .1.3.6.1.2.1.4.21.1.7 | Routing Table Gateway |

---

## Community String Discovery (One-liner)

### onesixtyone

```shell
# Quick community string brute
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt $rhost 2>/dev/null

# Scan entire subnet
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt $cidr 2>/dev/null | tee snmp_hosts.txt
```

### Hydra

```shell
hydra -P /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt $rhost snmp
```

### Metasploit (One-liner)

```shell
msfconsole -q -x "use auxiliary/scanner/snmp/snmp_login; set RHOSTS $rhost; run; exit"
```

---

## Windows Enumeration

```shell
# Windows users
snmpwalk -c public -v2c $rhost .1.3.6.1.4.1.77.1.2.25

# Running processes
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.25.4.2.1.2

# Installed software
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.25.6.3.1.2

# Using Metasploit
use auxiliary/scanner/snmp/snmp_enum
set RHOSTS $rhost
set COMMUNITY public
run

# Enumerate users
use auxiliary/scanner/snmp/snmp_enumusers
set RHOSTS $rhost
run

# Enumerate shares
use auxiliary/scanner/snmp/snmp_enumshares
set RHOSTS $rhost
run
```

---

## Attack Vectors

### Default Community Strings

```shell
snmpwalk -c public -v2c $rhost
snmpwalk -c private -v2c $rhost
snmpwalk -c admin -v2c $rhost
snmpwalk -c manager -v2c $rhost
snmpwalk -c community -v2c $rhost
```

### Write Access Exploitation

> If 'private' community string has write access

```shell
# Change system name
snmpset -v2c -c private $rhost .1.3.6.1.2.1.1.5.0 s "NewSystemName"
```

### Information Disclosure

```shell
# ARP cache (network mapping)
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.4.22.1.3

# Routing tables
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.4.21.1.1

# IP addresses
snmpwalk -c public -v2c $rhost ipAddrTable

# Usernames (Windows)
snmpwalk -c public -v2c $rhost .1.3.6.1.4.1.77.1.2.25
```
